# MozJPEG-GUI

用 C# 和 WPF 折腾的一个使用 [MozJPEG](https://github.com/mozilla/mozjpeg) 进行压图的 GUI 程序。

运行前请确定已经在电脑上安装了 .NET Framework 4.0。

### 使用截图

![](https://ae01.alicdn.com/kf/HTB12pVjd79E3KVjSZFG76319XXa8.png)

### 特性

* 只有单个文件，是**绿色版**程序。
    * `cjpeg.exe` 使用的是来自于 [garyzyg/mozjpeg-windows](https://github.com/garyzyg/mozjpeg-windows/releases) 的预编译版（v3.3.1 x64），并且使用 [UPX](https://github.com/upx/upx) 及参数 `--ultra-brute` 进行了压缩。
    * `cjpeg.exe` 是作为资源文件嵌入到程序本体中的。程序启动时会将 `cjpeg.exe` 释放到临时目录，退出时删除。

* 支持**打开 `png` 格式**的图片。
    * MozJPEG 只支持输入 `tga`、`bmp`、`ppm`、`jpg` 四种格式的图片，**不支持 `png`**，程序会自动将打开的图片转换为 `bmp`，存储在临时目录。
    * JPEG 不支持透明度，所以 PNG 图片的透明部分会变成白色。

* 参考了 Photoshop 的“存储为 Web 所用格式”界面，加入了**预览编码后的图片**和**保存图片时对图片进行缩放**的功能。
    * 预览功能实际上是按照参数对图片进行编码后将输出的图片显示在窗口中，如果要保存的话将预览的图片复制粘贴即可。
    * 缩放功能是先对原图进行缩放，存储在临时目录，然后将缩放后的图片拿去编码，MozJPEG 本身没有缩放图片的功能。

* **批处理功能**，可以对一个文件夹的所有图片进行编码。编码设定使用的是窗口上的设定，还可以选择按宽度/高度/百分比对批处理中的图片进行缩放。
    * “批处理”选择“按百分比缩放”，将百分比设为 50%，缩放后的图片宽度和高度都是原图的一半，设为 100% 就是不进行缩放。
    * “批处理”选择“等比例缩放至宽度”，将宽度设为 1000，缩放后的图片将按纵横比缩放至宽度为 1000 的大小。例如一张 6000x4000 的图片（也就是 3:2 的比例）就会被缩放到 1000x667。“等比例缩放至高度”同理。

* **图片格式的设定**，可以根据需要编码不同类型的图片（不改变质量，会改变文件大小）。不同格式的图片在网页上加载时显示的加载过程也有所不同。
    * “基本式”（baseline），图片从上至下逐渐显示。
    * “渐进式”（progressive），图片从模糊逐渐变清晰。
    * “渐进式”又可以继续分为“交错式”（interleaved）和“非交错式”（non-interleaved）。在加载模糊部分时，前者同时加载所有色彩通道；后者先加载亮度通道再加载色度通道，表现为先显示黑白图片，再逐渐向图片上添加颜色。一般情况下“非交错式”的图片文件大小要略微小于“交错式”。
    * 使用了 Firefox 的开发者工具[模拟在低速网络环境下打开图片的视频](https://files.catbox.moe/8derzy.mp4)，展示了不同格式的图片在加载过程中的具体效果。